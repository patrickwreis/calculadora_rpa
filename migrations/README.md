# Database Migrations

Este diretório contém as migrations do banco de dados gerenciadas pelo Alembic.

## Estrutura

```
migrations/
├── versions/          # Scripts de migration
├── env.py            # Configuração do ambiente Alembic
├── script.py.mako    # Template para novas migrations
└── README.md         # Este arquivo
```

## Comandos Úteis

### Criar uma nova migration (autogenerate)
```bash
alembic revision --autogenerate -m "descrição da mudança"
```

### Criar uma migration manual
```bash
alembic revision -m "descrição da mudança"
```

### Aplicar migrations
```bash
# Aplicar todas as migrations pendentes
alembic upgrade head

# Aplicar até uma revision específica
alembic upgrade <revision_id>

# Aplicar próxima migration
alembic upgrade +1
```

### Reverter migrations
```bash
# Reverter uma migration
alembic downgrade -1

# Reverter até uma revision específica
alembic downgrade <revision_id>

# Reverter todas
alembic downgrade base
```

### Visualizar histórico
```bash
# Ver histórico de migrations
alembic history

# Ver migrations pendentes
alembic current
```

## Melhores Práticas

1. **Sempre revise migrations autogenerated** antes de aplicar
2. **Teste migrations em ambiente de desenvolvimento** primeiro
3. **Use nomes descritivos** para as migrations
4. **Inclua dados de migração** quando necessário (ex: popular tabelas novas)
5. **Implemente downgrade** sempre que possível para reversibilidade
6. **Commit migrations com o código** que as utiliza

## Configuração

- **DATABASE_URL**: Configurado via variável de ambiente (ver `config/settings.py`)
- **target_metadata**: Configurado com `SQLModel.metadata` para autogenerate
- **Models**: Todos os models em `src/models/` são importados no `env.py`
